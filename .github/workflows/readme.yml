name: Readme

on:
  push:
    branches:
      - master
  release:
    types:
      - published

jobs:
  write_readme:
    name: 'Write Readme'
    runs-on: ubuntu-latest
    steps:
      - name: 'Clone'
        uses: actions/checkout@main
      - name: 'Deps'
        run: npm i
      - name: 'Write'
        run: node src/index.js
      - name: 'Commit'
        run: |
          git config user.name "Github Actions"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Updated README from GitHub action"
      - name: 'Push'
        run: git push -u origin master

  deploy_lambda:
    name: 'Deploy lambda'
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: lambda

    if: ${{ github.event_name == 'release' }}
    steps:
      - uses: jsmrcaga/action-easy-lambda-deploy@latest
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        with:
          function_name: github-readme
          region: eu-west-3
